# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ LocalSend ‚úÖ

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

### 1. ‚ùå –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Bad state: No element" –≤ ICE Candidates
**–ü—Ä–æ–±–ª–µ–º–∞**: `firstWhere()` –±—Ä–æ—Å–∞–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å `orElse: () => null` –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```dart
// –î–û - –∫—Ä–∞—à–∏–ª–æ—Å—å –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
final targetDevice = devices.firstWhere((device) => device.id == event.deviceId);

// –ü–û–°–õ–ï - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
final targetDevice = devices.cast<DeviceInfo?>().firstWhere(
  (device) => device?.id == event.deviceId,
  orElse: () => null,
);

if (targetDevice == null) {
  logError('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ${event.deviceId} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —Å–ø–∏—Å–∫–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö');
  return; // –ó–∞–≤–µ—Ä—à–∞–µ–º –±–µ–∑ –∫—Ä–∞—à–∞
}
```

### 2. ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

#### –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
- –ú–µ—Ç–æ–¥ `refreshDeviceDiscovery()` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç discovery ‚Üí –æ—á–∏—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ

#### –í UI:
- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (üîÑ) –≤ DevicesTab —Ä—è–¥–æ–º —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
- –í—ã–∑—ã–≤–∞–µ—Ç `refreshDeviceDiscovery()` –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
- Tooltip: "–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤"

### 3. üîç –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞–º–∏

#### SignalingService - –æ—Ç–ø—Ä–∞–≤–∫–∞:
```dart
logInfo('=== –û–¢–ü–†–ê–í–ö–ê –°–ò–ì–ù–ê–õ–ê ===', data: {
  'url': url,
  'type': message.type.name, 
  'fromDevice': message.fromDeviceId,
  'toDevice': message.toDeviceId,
  'statusCode': response.statusCode,
  'responseBody': responseBody,
});
```

#### SignalingService - –ø–æ–ª—É—á–µ–Ω–∏–µ:
```dart
logInfo('=== –ü–û–õ–£–ß–ï–ù –°–ò–ì–ù–ê–õ ===', data: {
  'type': message.type.name,
  'from': message.fromDeviceId,
  'to': message.toDeviceId,
  'fromAddress': request.connectionInfo?.remoteAddress.address,
  'timestamp': message.timestamp.toIso8601String(),
});
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, candidate, –ø–æ–∏—Å–∫ —Å—Ä–µ–¥–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ PeerConnection, —Å—Ç–∞—Ç—É—Å —É—Å–ø–µ—Ö–∞
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –µ—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞:
- HTTP –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –°—Ç–∞—Ç—É—Å –∫–æ–¥—ã –∏ —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–æ–≤
- IP –∞–¥—Ä–µ—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–µ—Ä–∂–µ–∫

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫—Ä–∞—à** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ–ª—å—à–µ –Ω–µ –∫—Ä–∞—à–∏—Ç—Å—è –Ω–∞ ICE candidates  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∏—Å–∫–∞** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤  
‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞  

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å discovery —É—Å—Ç—Ä–æ–π—Å—Ç–≤**: –≤–∏–¥—è—Ç –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥—Ä—É–≥ –¥—Ä—É–≥–∞
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP —Å–∏–≥–Ω–∞–ª–∏–Ω–≥**: –¥–æ—Ö–æ–¥—è—Ç –ª–∏ SDP offer/answer –∏ ICE candidates
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ª–∏ PeerConnection
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏**: —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ DataChannel –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π/—Ñ–∞–π–ª–æ–≤

–° —ç—Ç–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.