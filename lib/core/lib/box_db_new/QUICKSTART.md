# BoxDB - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –ß—Ç–æ —ç—Ç–æ?

BoxDB - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Dart —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å Freezed –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSONL —Ñ–æ—Ä–º–∞—Ç–∞.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 —à–∞–≥–∞)

### 1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å —Å Freezed

```dart
@freezed
class User with _$User {
  const User._();
  
  const factory User({
    required String id,
    required String name,
    required String email,
    required int age,
  }) = _User;

  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
}
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –ë–î

```dart
final db = await BoxDB.create<User>(
  name: 'users',
  basePath: 'data',
  fromJson: User.fromJson,
  toJson: (u) => u.toJson(),
  getId: (u) => u.id,
);
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CRUD

```dart
// Create
await db.insert(User(id: '1', name: 'Alice', email: 'alice@mail.com', age: 25));

// Read
final user = await db.get('1');

// Update
await db.update(user!.copyWith(age: 26));

// Delete
await db.delete('1');
```

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| üîê **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** | AES-GCM 256-bit, —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ |
| üíæ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** | JSONL —Ñ–æ—Ä–º–∞—Ç, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å—ë –≤ –ø–∞–º—è—Ç—å |
| ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å** | O(1) –¥–ª—è insert/get/update/delete |
| üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ID –≤ plaintext, –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã |
| ‚ôªÔ∏è **Backup** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ |
| üóúÔ∏è **–ö–æ–º–ø–∞–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ >30% –º—É—Å–æ—Ä–∞ |
| üîÑ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** | Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å Lock |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

```
my_database/
‚îú‚îÄ‚îÄ data.jsonl       # –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (append-only)
‚îú‚îÄ‚îÄ index.json       # {id: {line: N, deleted: bool}}
‚îú‚îÄ‚îÄ meta.json        # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ + –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ backup/          # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–ø–∏–∏
    ‚îî‚îÄ‚îÄ {timestamp}/
```

## –ü—Ä–∏–º–µ—Ä—ã

### –° –ø–∞—Ä–æ–ª–µ–º

```dart
final db = await BoxDB.create<User>(
  name: 'secure_db',
  basePath: 'data',
  password: 'my_password',  // SHA256 ‚Üí AES key
  // ...
);
```

### –ë–µ–∑ –ø–∞—Ä–æ–ª—è (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –∫–ª—é—á)

```dart
final db = await BoxDB.create<User>(
  name: 'auto_db',
  basePath: 'data',
  // password –Ω–µ —É–∫–∞–∑–∞–Ω ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á
  // –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ meta.json
  // ...
);
```

### –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î

```dart
final db = await BoxDB.open<User>(
  name: 'my_db',
  basePath: 'data',
  password: 'my_password',  // –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å
  // ...
);
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è backup
```

### –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```dart
// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞
await Future.wait([
  db.insert(user1),
  db.insert(user2),
  db.insert(user3),
]);

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ
final all = await db.getAll();
```

### Maintenance

```dart
// Backup –≤—Ä—É—á–Ω—É—é
await db.backup();

// –ö–æ–º–ø–∞–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é
await db.compact();

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
final count = await db.count();
final exists = await db.exists('user_123');
```

## API Cheatsheet

| –ú–µ—Ç–æ–¥ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------|----------|
| `create<T>()` | `Future<BoxDB<T>>` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ë–î |
| `open<T>()` | `Future<BoxDB<T>>` | –û—Ç–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é |
| `insert(item)` | `Future<void>` | –í—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å |
| `get(id)` | `Future<T?>` | –ü–æ–ª—É—á–∏—Ç—å –ø–æ ID |
| `update(item)` | `Future<void>` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å |
| `delete(id)` | `Future<void>` | –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å |
| `getAll()` | `Future<List<T>>` | –í—Å–µ –∑–∞–ø–∏—Å–∏ |
| `exists(id)` | `Future<bool>` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è |
| `count()` | `Future<int>` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π |
| `clear()` | `Future<void>` | –£–¥–∞–ª–∏—Ç—å –≤—Å–µ |
| `compact()` | `Future<void>` | –ö–æ–º–ø–∞–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| `backup()` | `Future<void>` | –°–æ–∑–¥–∞—Ç—å backup |
| `close()` | `Future<void>` | –ó–∞–∫—Ä—ã—Ç—å –ë–î |

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```dart
try {
  await db.insert(user);
} on BoxDBException catch (e) {
  if (e.message.contains('—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç')) {
    // –î—É–±–ª–∏–∫–∞—Ç
  }
} on EncryptionException catch (e) {
  // –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
}
```

## Best Practices

‚úÖ **DO:**
- –í—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ë–î –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (12+ —Å–∏–º–≤–æ–ª–æ–≤)
- –°–æ–∑–¥–∞–≤–∞—Ç—å backup –ø–µ—Ä–µ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `exists()` –ø–µ—Ä–µ–¥ `update()`

‚ùå **DON'T:**
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getAll()` –¥–ª—è –æ–≥—Ä–æ–º–Ω—ã—Ö –ë–î
- –ù–µ —Ç–µ—Ä—è—Ç—å –ø–∞—Ä–æ–ª—å (–¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º—ã)
- –ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ë–î –≤—Ä—É—á–Ω—É—é
- –ù–µ –∑–∞–±—ã–≤–∞—Ç—å –≤—ã–∑—ã–≤–∞—Ç—å `close()`

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ë–µ–Ω—á–º–∞—Ä–∫–∏ (—Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è):**
- Insert: ~1-2ms
- Get: ~0.5-1ms  
- Update: ~1-2ms
- Delete: ~0.1ms
- GetAll (1000 –∑–∞–ø–∏—Å–µ–π): ~100-200ms

**–ü–∞–º—è—Ç—å:**
- –ò–Ω–¥–µ–∫—Å: ~100 bytes/–∑–∞–ø–∏—Å—å
- –î–∞–Ω–Ω—ã–µ: –Ω–∞ –¥–∏—Å–∫–µ, –Ω–µ –≤ RAM

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
dart test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä
dart run bin/test_box_db.dart
```

‚úÖ **24 —Ç–µ—Å—Ç–∞** –≤–∫–ª—é—á–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ß—Ç–æ —à–∏—Ñ—Ä—É–µ—Ç—Å—è:**
- ‚úÖ –í—Å–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ –ú–∞—Å—Å–∏–≤—ã

**–ß—Ç–æ –ù–ï —à–∏—Ñ—Ä—É–µ—Ç—Å—è:**
- ‚ùå ID (–Ω—É–∂–µ–Ω –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞)

**–§–æ—Ä–º–∞—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏:**
```json
{
  "id": "user_123",
  "data": {
    "ciphertext": "...",
    "nonce": "...",
    "mac": "..."
  }
}
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/API.md`
- üí° –ü—Ä–∏–º–µ—Ä—ã: `example/example.dart`
- üß™ –¢–µ—Å—Ç—ã: `test/box_db_test.dart`
- üöÄ –î–µ–º–æ: `bin/test_box_db.dart`

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
