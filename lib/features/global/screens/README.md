# Global Screens

–û–±—â–∏–µ —ç–∫—Ä–∞–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö.

## ImageCropScreen

–≠–∫—Ä–∞–Ω –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–µ–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–∫–µ—Ç–∞ `crop_image`.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÇÔ∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üìê –†–∞–∑–ª–∏—á–Ω—ã–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω (—Å–≤–æ–±–æ–¥–Ω–æ–µ, 1:1, 4:3, 16:9, –∏ –¥—Ä.)
- üîÑ –ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
- ‚Ü©Ô∏è –°–±—Ä–æ—Å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (mobile/desktop)
- üé® –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–µ–∫—Ç–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### 1. –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```dart
import 'package:hoplixi/features/global/screens/image_crop_screen.dart';
import 'package:hoplixi/router/routes_path.dart';
import 'package:image_picker/image_picker.dart';
```

#### 2. –í—ã–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –≥–∞–ª–µ—Ä–µ–∏

```dart
Future<void> _pickAndCropImage() async {
  // –í—ã–±–∏—Ä–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  final pickedFile = await ImagePicker().pickImage(
    source: ImageSource.gallery,
  );
  
  if (pickedFile != null) {
    final bytes = await pickedFile.readAsBytes();
    
    // –°–æ–∑–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —ç–∫—Ä–∞–Ω –æ–±—Ä–µ–∑–∫–∏
    final imageData = ImageCropData(
      imageBytes: bytes,
      sourceName: '–ò–º–ø–æ—Ä—Ç QR-–∫–æ–¥–∞', // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    );
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –æ–±—Ä–µ–∑–∫–∏ –∏ –æ–∂–∏–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    final result = await context.push(
      AppRoutes.imageCrop,
      extra: imageData,
    );
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    if (result != null && result is CroppedImageResult) {
      // result.croppedImageWidget - Widget —Å –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
      // result.croppedImageBytes - –±–∞–π—Ç—ã –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG)
      // result.cropRect - –æ–±–ª–∞—Å—Ç—å –æ–±—Ä–µ–∑–∫–∏ (Rect)
      // result.imageSize - —Ä–∞–∑–º–µ—Ä –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      _processImage(result.croppedImageBytes);
    }
  }
}
```

#### 3. –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å QR-–∫–æ–¥–æ–º (–∫–∞–∫ –≤ ImportOtpScreen)

```dart
Future<void> _pickImageAndDecodeQR() async {
  final pickedFile = await ImagePicker().pickImage(
    source: ImageSource.gallery,
  );
  
  if (pickedFile != null) {
    final bytes = await pickedFile.readAsBytes();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–±—Ä–µ–∑–∫–∏
    final cropResult = await context.push(
      AppRoutes.imageCrop,
      extra: ImageCropData(
        imageBytes: bytes,
        sourceName: 'QR-–∫–æ–¥ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞',
      ),
    );
    
    if (cropResult != null && cropResult is CroppedImageResult && mounted) {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è QR
      final image = img.decodeImage(cropResult.croppedImageBytes);
      
      if (image != null) {
        final source = RGBLuminanceSource(
          image.width,
          image.height,
          image
              .convert(numChannels: 4)
              .getBytes(order: img.ChannelOrder.abgr)
              .buffer
              .asInt32List(),
        );
        final bitmap = BinaryBitmap(GlobalHistogramBinarizer(source));
        final reader = QRCodeReader();
        
        try {
          final result = reader.decode(bitmap);
          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º QR-–∫–æ–¥
          _processQRCode(result.text);
        } catch (e) {
          ToastHelper.error(
            title: '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥',
            description: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±—Ä–µ–∑–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ—á–Ω–µ–µ',
          );
        }
      }
    }
  }
}
```

#### 4. –ü—Ä–∏–º–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞/–∏–∫–æ–Ω–∫–∏

```dart
Future<void> _selectAndCropAvatar() async {
  final pickedFile = await ImagePicker().pickImage(
    source: ImageSource.gallery,
    maxWidth: 1024,
    maxHeight: 1024,
  );
  
  if (pickedFile != null) {
    final bytes = await pickedFile.readAsBytes();
    
    final cropResult = await context.push(
      AppRoutes.imageCrop,
      extra: ImageCropData(
        imageBytes: bytes,
        sourceName: '–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
      ),
    );
    
    if (cropResult != null && cropResult is CroppedImageResult) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      setState(() {
        _avatarBytes = cropResult.croppedImageBytes;
      });
      
      // –ò–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ä–∞–∑—É
      Image.memory(cropResult.croppedImageBytes);
    }
  }
}
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

‚úÖ **–°–ª–µ–¥—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Hoplixi:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ToastHelper` –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `app_logger.dart`
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (`SmoothButton`)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (mobile/tablet/desktop)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ try-catch
- ServiceResult –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (UI-only –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ù–µ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

‚úÖ **UX:**
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
- –ü–æ–Ω—è—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (tooltips)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–±—Ä–æ—Å–∞ –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- –û—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

#### ImageCropData
–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –æ–±—Ä–µ–∑–∫–∏.

```dart
class ImageCropData {
  final Uint8List imageBytes;  // –ë–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  final String? sourceName;     // –ò–º—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
}
```

#### CroppedImageResult
–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–µ–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

```dart
class CroppedImageResult {
  final Widget croppedImageWidget;    // Widget –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  final Uint8List croppedImageBytes;  // –ë–∞–π—Ç—ã –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG)
  final Rect cropRect;                // –û–±–ª–∞—Å—Ç—å –æ–±—Ä–µ–∑–∫–∏ (0.0-1.0)
  final Size imageSize;               // –†–∞–∑–º–µ—Ä –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
}
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω

- üÜì **–°–≤–æ–±–æ–¥–Ω–æ–µ** - –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- ‚¨ú **–ö–≤–∞–¥—Ä–∞—Ç (1:1)** - –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤, –∏–∫–æ–Ω–æ–∫
- üì± **–ü–æ—Ä—Ç—Ä–µ—Ç (3:4)** - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ
- üñºÔ∏è **–ü–µ–π–∑–∞–∂ (4:3)** - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ
- üì∫ **–®–∏—Ä–æ–∫–∏–π (16:9)** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤–∏–¥–µ–æ
- üì≤ **–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π (9:16)** - –º–æ–±–∏–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
- üé¨ **–ö–∏–Ω–æ (21:9)** - –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç
- üìè **2:1** - –ø–∞–Ω–æ—Ä–∞–º–∞

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

| –î–µ–π—Å—Ç–≤–∏–µ | –ö–Ω–æ–ø–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏ | üìê | –í—ã–±–æ—Ä —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω |
| –ü–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ | ‚Ü∫ | –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ 90¬∞ –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π |
| –ü–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ | ‚Üª | –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ 90¬∞ –ø–æ —á–∞—Å–æ–≤–æ–π |
| –°–±—Ä–æ—Å | ‚Ü©Ô∏è | –í–æ–∑–≤—Ä–∞—Ç –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é |
| –ì–æ—Ç–æ–≤–æ | ‚úì | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∫–∏ |

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `crop_image: ^1.0.16`
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** `image` package
- **–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:** PNG (Uint8List)
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** 100px
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** 400px (mobile), 800px (desktop)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** `ImageCropScreen` tag

### –ü—Ä–∏–º–µ—Ä –≤ –ø—Ä–æ–µ–∫—Ç–µ

–°–º. –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤:
- `lib/features/password_manager/dashboard/screens/import_otp_screen.dart` - –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ QR-–∫–æ–¥–æ–≤ –ø–µ—Ä–µ–¥ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `lib/features/password_manager/icons_manager/` - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫
- –õ—é–±—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

–ú–∞—Ä—à—Ä—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `lib/router/routes_path.dart` –∫–∞–∫ `AppRoutes.imageCrop`.

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `ImageCropData` —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `extra` –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏!

```dart
context.push(AppRoutes.imageCrop, extra: imageData);
```

–ë–µ–∑ `extra` –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏.
