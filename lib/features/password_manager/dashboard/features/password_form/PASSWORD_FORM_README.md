# Экран добавления/редактирования паролей

Безопасный экран для создания и редактирования паролей с автоматической очисткой чувствительных данных.

## Компоненты

### `PasswordFormScreen`
Основной виджет экрана формы пароля.

**Параметры:**
- `passwordId` - ID пароля для редактирования (null для создания нового)

**Основные функции:**
- ✅ Создание новых паролей
- ✅ Редактирование существующих паролей
- ✅ Валидация полей в реальном времени
- ✅ Интеграция с пикерами категорий и тегов
- ✅ Встроенный генератор паролей
- ✅ Переключение видимости пароля
- ✅ Автоматическая безопасная очистка данных

### `PasswordFormState`
Модель состояния формы с безопасным управлением данными.

**Основные методы:**
- `savePassword()` - сохранение пароля
- `validateForm()` - валидация формы
- `clearSensitiveData()` - безопасная очистка чувствительных данных
- `togglePasswordVisibility()` - переключение видимости пароля
- `toggleFavorite()` - переключение избранного

### `PasswordGenerator`
Генератор случайных паролей с настраиваемыми параметрами.

**Возможности:**
- Настраиваемая длина пароля (6-50 символов)
- Включение/исключение типов символов (A-Z, a-z, 0-9, символы)
- Исключение похожих символов (i, l, 1, L, o, 0, O)
- Индикатор сложности пароля
- Предпросмотр сгенерированного пароля

## Безопасность

### Автоматическая очистка данных
Экран автоматически очищает чувствительные данные в следующих случаях:

1. **При закрытии экрана** - вызов `dispose()`
2. **При сворачивании приложения** - `AppLifecycleState.paused`
3. **При закрытии приложения** - `AppLifecycleState.detached`
4. **При нажатии кнопки "Отмена"**

### Безопасная очистка памяти
```dart
void _clearTextControllerSecurely(TextEditingController controller) {
  // Заполняем случайными символами для затирания данных из памяти
  final originalLength = controller.text.length;
  if (originalLength > 0) {
    final randomData = List.generate(originalLength, (index) => 
        String.fromCharCode(48 + (DateTime.now().millisecondsSinceEpoch + index) % 75));
    controller.text = randomData.join();
    controller.clear();
  }
}
```

### Валидация
- **Название** - обязательное поле
- **Пароль** - обязательное поле
- **URL** - валидация формата URL (опционально)
- **Email** - валидация формата email (опционально)
- **Логин ИЛИ Email** - должен быть заполнен хотя бы один

## Использование

### Создание нового пароля
```dart
Navigator.of(context).push(
  MaterialPageRoute(
    builder: (context) => const PasswordFormScreen(),
  ),
);
```

### Редактирование существующего пароля
```dart
Navigator.of(context).push(
  MaterialPageRoute(
    builder: (context) => const PasswordFormScreen(
      passwordId: 'existing-password-id',
    ),
  ),
);
```

### Обработка результата
```dart
Navigator.of(context).push(
  MaterialPageRoute(
    builder: (context) => const PasswordFormScreen(),
  ),
).then((result) {
  if (result == true) {
    // Пароль был успешно сохранен
    // Обновить список паролей
  }
});
```

## Архитектура

### Провайдеры
- `passwordFormStateProvider` - управление состоянием формы
- `passwordsDaoProvider` - доступ к данным паролей
- `categoriesServiceProvider` - сервис категорий
- `tagsServiceProvider` - сервис тегов

### Зависимости
- `PrimaryTextFormField` - кастомные поля ввода
- `SmoothButton` - кастомные кнопки
- `CategoriesPicker` - выбор категорий
- `TagsPicker` - выбор тегов
- `ToastHelper` - уведомления

## Стили и UI

### Адаптивный дизайн
- Скроллируемая область с полями
- Фиксированная кнопка сохранения внизу
- Учет безопасной области устройства
- Переключаемый генератор паролей

### Валидация в реальном времени
- Индикация ошибок в полях
- Показ требований к полям
- Отключение кнопки сохранения при ошибках

### UX/UI особенности
- Автофокус на полях
- Последовательность перехода между полями
- Кнопка закрытия в AppBar
- Предотвращение случайного закрытия экрана
- Индикатор загрузки при сохранении

## TODO
- [ ] Поддержка вложений к паролям
- [ ] Поддержка связей с TOTP
- [ ] Импорт паролей из файлов
- [ ] Экспорт в различные форматы
- [ ] История изменений пароля
- [ ] Проверка компрометации пароля